<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <style>
        #form_datos {
            background-color: rgba(32, 214, 224, 0.479);
            padding: 50px;
            border-radius: 0px;
        }
    
        #formABM {
            margin: 0 auto 10px auto;
            padding: 20px;
            background-color: rgba(191, 232, 245, 0.61);
            border-radius: 50px;
            text-align: left;
        }
    
        #form_datos,
        #formABM {
            margin: 0 auto;
            display: inline-block;
            text-align: left;
        }
    
        body {
            max-width: 900px;
            font-family: Arial, sans-serif;
            margin: 0 auto;
            padding: 30px;
            flex-direction: column;
            position: relative;
            text-align: center;
            background-color: rgba(227, 191, 245, 0.281);
        }
    
        label[for="txtNombre"],
        label[for="txtApellido"],
        label[for="txtEdad"] {
            font-weight: bold;
        }
    
        input:required {
            border-color: red;
        }
    
        .error-message {
            color: red;
            font-style: italic;
            font-size: 12px;
            margin-top: 5px;
        }
    
        table,
        td,
        th {
            border: 1px solid black;
        }
    
        td,
        th {
            padding: 5px;
            font-size: 14px;
        }
    
        thead {
            background-color: rgb(179, 255, 0);
        }
    
        table {
            width: 700px;
            border-radius: 10px;
            border-collapse: collapse;
            position: relative;
            text-align: center;
        }
    
        tbody tr:hover {
            background-color: rgba(107, 212, 78, 0.534);
        }
    
        button {
            background-color: rgb(240, 86, 86);
            padding: 15px;
            border-radius: 20px;
            width: 200px;
            margin: 10px auto;
            display: block;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
    
        input,
        select {
            background-color: rgb(253, 253, 253);
            border: 1px solid black;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 3px;
            font-size: 14px;
        }
    
        select {
            width: 80%;
        }
    
        .error-message {
            color: red;
            font-style: italic;
            font-size: 12px;
        }
    </style>
    
    
    
</head>

<body>
    <div id="formDatos">
        <form id="form_datos">
            <label for="filtroPersona">Filtrar por:</label>
            <select id="filtroPersona">
                <option value="todos">Todos</option>
                <option value="futbolistas">FUtbolistas</option>
                <option value="profesionales">profesionales</option>
            </select>
            <br>
            <br>
            <label>Calcular la edad promedio:</label>
            <input type="text" id="txtPromedio" readonly>
            <button type="button" id="btnCalcular">Calcular</button>
            <br>
            <br>
            <label>Listado:</label>
            <br>
            
            <input type="checkbox" id="id" name="Id" checked>
            <label for="id">ID</label>

            
            <input type="checkbox" id="nombre" name="Nombre" checked>
            <label for="nombre">Nombre</label>

            
            <input type="checkbox" id="apellido" name="Apellido" checked>
            <label for="apellido">Apellido</label>

            
            <input type="checkbox" id="edad" name="Edad" checked>
            <label for="edad">Edad</label>
            
            <input type="checkbox" id="equipo" name="Equipo" checked>
            <label for="equipo">equipo</label>
            
            <input type="checkbox" id="posicion" name="Posicion" checked>
            <label for="posicion">Posicion</label>
            
            <input type="checkbox" id="cantidadGoles" name="cantidadGoles" checked>
            <label for="cantidadGoles">cantidadGoles</label>
            
            <input type="checkbox" id="titulo" name="Titulo" checked>
            <label for="titulo">Titulo</label>
            
            <input type="checkbox" id="facultad" name="Facultad" checked>
            <label for="facultad">Facultad</label>
            
            <input type="checkbox" id="añoGraduacion" name="añoGraduacion" checked>
            <label for="añoGraduacion">añoGraduacion</label>
            
            <br>
            <table id="tabla_datos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Edad</th>
                        <th>equipo</th>
                        <th>Posicion</th>
                        <th>cantidadGoles</th>
                        <th>Titulo</th>
                        <th>Facultad</th>
                        <th>añoGraduacion</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <br>
        </form>
        <button id="btnAgregar">Agregar</button>
    </div>
    <br>


    <!-- ABM -->

    <div id="form_ABM">
        <form id="formABM">
            <label for="id">ID:</label>
            <input type="text" id="txtId" readonly>
            <br>
            <label for="nombre">Nombre:</label>
            <input type="text" id="txtNombre">
            <p class="error-message"></p>
            <br>
            <label for="apellido">Apellido:</label>
            <input type="text" id="txtApellido">
            <p class="error-message"></p>
            <br>
            <label for="edad">Edad:</label>
            <input type="text" id="txtEdad" >
            <p class="error-message"></p>
            <br>
            <label for="tipo">Tipo:</label>
            <select id="selecTipo">
                <option value="persona">Persona</option>
                <option value="futbolista">FUtbolista</option>
                <option value="profesional">Profesional</option>
            </select>
            <br>
            <label id="lblAtributo1" for="txtAtributo1">Atributo1</label>
            <input type="text" id="txtAtributo1">
            <p class="error-message"></p>
            <br>
            <label id="lblAtributo2" for="txtAtributo2">Atributo2</label>
            <input type="text" id="txtAtributo2">
            <p class="error-message"></p>
            <br>
            <label id="lblAtributo3" for="txtAtributo3">Atributo3</label>
            <input type="text" id="txtAtributo3">
            <p class="error-message"></p>
            <br>
            <button type="button" id="btnGuardar">Guardar</button>
            <button type="button" id="btnModificar">Modificar</button>
            <button type="button" id="btnEliminar">Eliminar</button>
            <button type="button" id="btnCancelar">Cancelar</button>
        </form>
    </div>
</body>
<script>
    //  ----->   CLASES 
    class Persona {
        constructor(id, nombre, apellido, edad) {
            this.id = id;
            this.nombre = nombre;
            this.apellido = apellido;
            this.edad = edad;
        }

        toString() {
        return `Persona [nombre=${this.nombre}, edad=${this.edad}]`;
        }

        

        
    }

    class FUtbolista extends Persona {
        constructor(id, nombre, apellido, edad, equipo, posicion, cantidadGoles) {
        super(id, nombre, apellido, edad);
            this.equipo = equipo;
            this.posicion = posicion;
            this.cantidadGoles = cantidadGoles;
        }

        toString() {
        return `Futbolista [nombre=${this.nombre}, edad=${this.edad}, equipo=${this.equipo}]`;
        }
        

    }



    class Profesional extends Persona {
        constructor(id, nombre, apellido, edad, titulo, facultad, añoGraduacion) {
            super(id, nombre, apellido, edad);
            this.titulo = titulo;
            this.facultad = facultad;
            this.añoGraduacion = añoGraduacion;
        }

        toString() {
        return `Profesional [nombre=${this.nombre}, edad=${this.edad}, equipo=${this.equipo}, cantidadGoles=${this.cantidadGoles}]`;
        }
    }
    
    
    const data = JSON.parse('[{"id":1, "nombre":"Marcelo", "apellido":"Luque", "edad":45, "titulo":"Ingeniero", "facultad":"UTN", "añoGraduacion":2002},{"id":2, "nombre":"Ramiro", "apellido":"Escobar", "edad":35, "titulo":"Medico", "facultad":"UBA", "añoGraduacion":20012},{"id":3, "nombre":"Facundo", "apellido":"Cairo", "edad":30, "titulo":"Abogado", "facultad":"UCA", "añoGraduacion":2017},{"id":4, "nombre":"Fernando", "apellido":"Nieto", "edad":18, "equipo":"Independiente", "posicion":"Delantero", "cantidadGoles":7},{"id":5, "nombre":"Manuel", "apellido":"Loza", "edad":20, "equipo":"Racing", "posicion":"Volante", "cantidadGoles":2},{"id":6, "nombre":"Nicolas", "apellido":"Serrano", "edad":23, "equipo":"Boca", "posicion":"Arquero", "cantidadGoles":0}]');

    // Creo array de objetos
    const objetos = data.map(obj => {
        if (obj.hasOwnProperty('posicion') && obj.hasOwnProperty('cantidadGoles')) {
            return new FUtbolista(obj.id, obj.nombre, obj.apellido, obj.edad, obj.equipo, obj.posicion, obj.cantidadGoles);
        } else if (obj.hasOwnProperty('titulo') && obj.hasOwnProperty('facultad') && obj.hasOwnProperty('añoGraduacion')) {
            return new Profesional(obj.id, obj.nombre, obj.apellido, obj.edad, obj.titulo, obj.facultad, obj.añoGraduacion);
        } else {
            return new Persona(obj.id, obj.nombre, obj.apellido, obj.edad);
        }
    });
    
    const form = $('form_datos');
    const form_div = $('form_div')
    const tabla = $('tabla_datos');
    const checkboxes = form.querySelectorAll('input[type=checkbox]');
    const filtroSelect = $('filtroPersona');
    const promedioInput = $('txtPromedio');
    const id = $('txtId');
    const calcularBtn = $('btnCalcular');
    const agregarBtn = $('btnAgregar');
    const cancelarBtn = $('btnCancelar');
    const guardarBtn = $('btnGuardar');
    const modificarBtn = $('btnModificar');
    const eliminarBtn = $('btnEliminar');
    const label1 = $('lblAtributo1');
    const label2 = $('lblAtributo2');
    const label3 = $('lblAtributo3');
    const input1 = $('txtAtributo1');
    const input2 = $('txtAtributo2');
    const input3 = $('txtAtributo3');
    const formABM = $('formABM');
    const filtroTipo = $('selecTipo');
    const formulario = document.forms[1];
    const controles = formulario.elements;


    // Lista de Eventos:

    // Boton Calcular
    calcularBtn.addEventListener('click', calcularPromedio);


    // Carga de Pagina
    window.addEventListener("load", () => {
        llenarTabla(objetos);
        ocultarFormAbm();
    });

    // Checkboxes
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            llenarTabla(objetos)
        });
    });

    

    // Cambio de Valor de filtro
    filtroSelect.addEventListener('change', () => {
        llenarTabla(objetos);
        promedioInput.value = ''; 
    });


    
    filtroTipo.addEventListener('change', () => {
        if (selecTipo.value == 'futbolista') {
            label1.textContent = "equipo";
            label2.textContent = "Posicion";
            label3.textContent = "cantidadGoles";
            input1.style.display = "flex";
            input2.style.display = "flex";
            input3.style.display = "flex";
        } else if (selecTipo.value == 'profesional') {
            label1.textContent = "Titulo";
            label2.textContent = "Facultad";
            label3.textContent = "añoGraduacion";
            input1.style.display = "flex";
            input2.style.display = "flex";
            input3.style.display = "flex";
        } else {
           label1.textContent = "Dejar campos vacios";
           label2.textContent = "Dejar campos vacios";
           label3.textContent = "Dejar campos vacios";
           input1.style.display = "Dejar campos vacios";
           input2.style.display = "Dejar campos vacios";
           input3.style.display = "Dejar campos vacios";
        }
    });

    
    
    agregarBtn.addEventListener('click', () => {
        ocultarFormDatos();
        limpiarForm();
        abrirFormAbm(null, objetos);
        guardarBtn.style.display = 'flex'; 
        modificarBtn.style.display = 'none'; 
        eliminarBtn.style.display = 'none'; 
        cancelarBtn.style.display = 'flex'; 
    });

    guardarBtn.addEventListener('click', () => {
        if (validarFormulario()) {
            agregarPersona(objetos);
            ocultarFormAbm();
            llenarTabla(objetos);
            limpiarForm();
        }
    });
    
    
    modificarBtn.addEventListener('click', () => { 
        modificarPersona(txtId.value,objetos); 
        ocultarFormAbm();
        llenarTabla(objetos);
        limpiarForm();
        
    });

    eliminarBtn.addEventListener('click', () => { 
        const index = objetos.findIndex((persona) => persona.id == txtId.value);
        objetos.splice(index, 1); 
        ocultarFormAbm(); 
        llenarTabla(objetos); 
    });

    

    cancelarBtn.addEventListener('click', () => {
        limpiarForm();
        ocultarFormAbm();
    });

    
    tabla.addEventListener('dblclick', (event) => {
        const emisor = event.target;
        console.log(event)
        
        if (emisor.tagName === 'TD') {
            const fila = emisor.parentNode;
            console.log(fila)
            const id = fila.firstElementChild.textContent;
            const person = objetos.find(objeto => objeto.id == id);
            abrirFormAbm(person, objetos);
            ocultarFormDatos(); 
            guardarBtn.style.display = 'none'; 
            modificarBtn.style.display = 'flex'; 
            eliminarBtn.style.display = 'flex'; 
            cancelarBtn.style.display = 'flex'; 
        }
        if (emisor.tagName === 'TH') {
            console.log(emisor.cellIndex);
            ordenarTabla(emisor.cellIndex);
        }
    });

    // Funciones:

    function ocultarFormDatos() {
        form.style.display = 'none';
        formABM.style.display = 'block';
        agregarBtn.style.display = 'none';
    }
    function ocultarFormAbm() {
        formABM.style.display = 'none';
        form.style.display = 'block';
        agregarBtn.style.display = 'block';
    }

    function ordenarTabla(columna) {
        const tbody = document.querySelector('table tbody');
        const filas = Array.from(tbody.querySelectorAll('tr'));

        
        const datos = filas.map(fila => fila.querySelectorAll('td')[columna].textContent);

        // Ordenamiento:
        if (isNaN(datos[0])) {
            datos.sort();
        } else {
            datos.sort((a, b) => parseFloat(a) - parseFloat(b));
        }

        // Nueva tabla ordenada:
        const nuevaTabla = document.createElement('table');
        nuevaTabla.appendChild(document.querySelector('table thead').cloneNode(true));
        const nuevoTbody = document.createElement('tbody');
        datos.forEach(dato => {
            const fila = filas.find(fila => fila.querySelectorAll('td')[columna].textContent === dato);
            nuevoTbody.appendChild(fila.cloneNode(true));
        });
        nuevaTabla.appendChild(nuevoTbody);

        
        tbody.parentNode.replaceChild(nuevoTbody, tbody);
    }

    function $(id) {
        return document.getElementById(id);
    }

    function abrirFormAbm(persona, lista) {
        const {
            txtId,
            txtNombre,
            txtApellido,
            txtEdad,
            selecTipo,
            txtAtributo1,
            txtAtributo2,
            txtAtributo3,
        } = controles;
        if (persona != null) {
            if ("posicion" in persona) {
                label1.textContent = "equipo";
                txtAtributo1.value = persona.equipo;
                label2.textContent = "Posicion";
                txtAtributo2.value = persona.posicion;
                label3.textContent = "cantidadGoles";
                txtAtributo3.value = persona.cantidadGoles;
                selecTipo.value = "futbolista";
            } else if ("titulo" in persona) {
                label1.textContent = "Titulo";
                txtAtributo1.value = persona.titulo;
                label2.textContent = "Facultad";
                txtAtributo2.value = persona.facultad;
                label3.textContent = "añoGraduacion";
                txtAtributo3.value = persona.añoGraduacion;
                selecTipo.value = "profesional";
            } else {
                label1.textContent = "";
                label2.textContent = "";
                label3.textContent = "";
                selecTipo.value = "persona";
            }
            txtId.value = persona.id;
            txtNombre.value = persona.nombre;
            txtApellido.value = persona.apellido;
            txtEdad.value = persona.edad;

        } else {
            txtId.value = ''; 
        }

    }

    function filtrarInstancias(datos, filtro) {
        let datosFiltrados = datos.filter((dato) => {
            if (filtro === "todos") {
                return true;
            } else if (filtro === "persona") {
                return dato instanceof Persona;
            } else if (filtro === "futbolistas") {
                return dato instanceof FUtbolista;
            } else if (filtro === "profesionales") {
                return dato instanceof Profesional;
            }
        });
        return datosFiltrados;
    }
    function cambiarLabel(tipo) {
        const atributo1 = $()
        if (tipo == "futbolistas") {

        } else if (filtro === "persona") {
            return dato instanceof Persona;
        } else if (filtro === "futbolistas") {
            return dato instanceof FUtbolista;
        } else if (filtro === "profesionales") {
            return dato instanceof Profesional;
        }
    }
    function calcularPromedio() {

        //Datos filtrados
        let objetosFiltrados = filtrarInstancias(objetos, filtroSelect.value)
        const edades = objetosFiltrados.map((objeto) => parseInt(objeto.edad));
        const sumaEdades = edades.reduce((suma, edad) => suma + edad, 0);
        const cantidadDatos = objetosFiltrados.length;

        // Calculo de promedios
        const promedio = sumaEdades / cantidadDatos;
        promedioInput.value = promedio.toFixed(2);
    }

    function llenarTabla(objetos) {
        const columnas = [];
        const objetosFiltrados = filtrarInstancias(objetos, filtroSelect.value)
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                columnas.push(checkbox.name);
            }
        });

        let tablaHTML = '<thead><tr>';
        columnas.forEach(columna => {
            tablaHTML += `<th>${columna}</th>`;
        });
        tablaHTML += '</tr></thead>';
        tablaHTML += '<tbody>';
        objetosFiltrados.forEach(objeto => {
            tablaHTML += '<tr>';
            columnas.forEach(columna => {
                tablaHTML += `<td>${objeto[columna.toLowerCase()] || '--'}</td>`;
            });
            tablaHTML += '</tr>';
        });
        tablaHTML += '</tbody>';
        tabla.innerHTML = tablaHTML;
    }

    function getMaxId(objetos) {
        return objetos.reduce((maxId, obj) => Math.max(maxId, obj.id), 0);
    }

    function validarFormulario() {
        const {
            txtId,
            txtNombre,
            txtApellido,
            txtEdad,
            selecTipo,
            txtAtributo1,
            txtAtributo2,
            txtAtributo3,
        } = controles;
        if (txtNombre.value.trim() === '') {
            txtNombre.classList.add('error');
            txtNombre.nextElementSibling.textContent = 'Debe cargar un nombre';
            return false;
        } else {
            txtNombre.classList.remove('error');
            txtNombre.nextElementSibling.textContent = '';
        }

        if (txtApellido.value.trim() === '') {
            txtApellido.classList.add('error');
            txtApellido.nextElementSibling.textContent = 'Debe cargar un apellido';
            return false;
        } else {
            txtApellido.classList.remove('error');
            txtApellido.nextElementSibling.textContent = '';
        }

        if (txtEdad.value.trim() === '' || isNaN(txtEdad.value) || txtEdad.value < 15) {
            txtEdad.classList.add('error');
            txtEdad.nextElementSibling.textContent = 'La Edad debe ser mayor a 15';
            return false;
        } else {
            txtEdad.classList.remove('error');
            txtEdad.nextElementSibling.textContent = '';
        }

        if (selecTipo.value == 'futbolista') {
            if (txtAtributo1.value.trim() === '') {
                txtAtributo1.classList.add('error');
                txtAtributo1.nextElementSibling.textContent = 'Debe cargar equipo'
            } else {
                txtAtributo1.classList.remove('error');
                txtAtributo1.nextElementSibling.textContent = '';
            }
            if (txtAtributo2.value.trim() === '') {
                txtAtributo2.classList.add('error');
                txtAtributo2.nextElementSibling.textContent = 'Debe Cargar Posicion'
            } else {
                txtAtributo2.classList.remove('error');
                txtAtributo2.nextElementSibling.textContent = '';
            }
            if (txtAtributo3.value.trim() === '' || isNaN(txtAtributo3.value) || txtAtributo3.value < -1) {
                txtAtributo3.classList.add('error');
                txtAtributo3.nextElementSibling.textContent = 'La cantidad de goles debe ser mayot a -1'
            } else {
                txtAtributo3.classList.remove('error');
                txtAtributo3.nextElementSibling.textContent = '';
            }

        }
        if (selecTipo.value == 'profesional') {
            if (txtAtributo1.value.trim() === '') {
                txtAtributo1.classList.add('error');
                txtAtributo1.nextElementSibling.textContent = 'Debe cargar Titulo'
            } else {
                txtAtributo1.classList.remove('error');
                txtAtributo1.nextElementSibling.textContent = '';
            }
            if (txtAtributo2.value.trim() === '' || isNaN(txtAtributo2.value)) {
                txtAtributo2.classList.add('error');
                txtAtributo2.nextElementSibling.textContent = 'Debe Cargar facultad'
            } else {
                txtAtributo2.classList.remove('error');
                txtAtributo2.nextElementSibling.textContent = '';
            }
            if (txtAtributo3.value.trim() === '' || isNaN(txtAtributo3.value) || txtAtributo3.value < 1950) {
                txtAtributo3.classList.add('error');
                txtAtributo3.nextElementSibling.textContent = 'Los añoGraduacion son obligatorios y mayor a 1950'
            } else {
                txtAtributo3.classList.remove('error');
                txtAtributo3.nextElementSibling.textContent = '';
            }
        }

        return true;
    }
    
    
    
    function limpiarForm() {
        const {
            txtId,
            txtNombre,
            txtApellido,
            txtEdad,
            selecTipo,
            txtAtributo1,
            txtAtributo2,
            txtAtributo3,
        } = controles;

        txtId.value = '';
        txtNombre.value = '';
        txtApellido.value = '';
        txtEdad.value = '';
        txtAtributo1.value = '';
        txtAtributo2.value = '';
        txtAtributo3.value = '';
    }
    
    
    
    function agregarPersona(lista) {
        const {
            txtNombre,
            txtApellido,
            txtEdad,
            selecTipo,
            txtAtributo1,
            txtAtributo2,
            txtAtributo3,
        } = controles;

        const id = getMaxId(lista)+1;
            if (selecTipo.value == 'futbolista') {
                lista.push(
                    new FUtbolista(
                        id,
                        txtNombre.value,
                        txtApellido.value,
                        txtEdad.value,
                        txtAtributo1.value,
                        txtAtributo2.value,
                        txtAtributo3.value
                    )
                );
            } else if (selecTipo.value == 'profesional') {
                lista.push(
                    new Profesional(
                        id,
                        txtNombre.value,
                        txtApellido.value,
                        txtEdad.value,
                        txtAtributo1.value,
                        txtAtributo2.value,
                        txtAtributo3.value
                    )
                );
            } else {
                lista.push(new Persona(txtId.value, txtNombre.value, txtApellido.value, txtEdad.value));
            }
    }
    function modificarPersona(id,lista) {
        const {
            txtId,
            txtNombre,
            txtApellido,
            txtEdad,
            selecTipo,
            txtAtributo1,
            txtAtributo2,
            txtAtributo3,
        } = controles;

        const index = lista.findIndex((persona) => persona.id == id);
        
        if (selecTipo.value == 'futbolista') {
            lista[index].nombre = txtNombre.value;
            lista[index].apellido = txtApellido.value;
            lista[index].edad = txtEdad.value;
            lista[index].equipo = txtAtributo1.value;
            lista[index].posicion = txtAtributo2.value;
            lista[index].cantidadGoles = txtAtributo3.value;
        } else if (selecTipo.value == 'profesional') {
            lista[index].nombre = txtNombre.value;
            lista[index].apellido = txtApellido.value;
            lista[index].edad = txtEdad.value;
            lista[index].titulo = txtAtributo1.value;
            lista[index].facultad = txtAtributo2.value;
            lista[index].añoGraduacion = txtAtributo3.value;
        } else {
            lista[index].nombre = txtNombre.value;
            lista[index].apellido = txtApellido.value;
            lista[index].edad = txtEdad.value;
        }
        console.log(lista)
    }


    



</script>

</html>


